<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>更新顾客信息</title>
<style type="text/css">
*{
	margin: 0;
	padding: 0;
}
#wrap {
	height: 900px;
	width: 100%;
    background-color:#CCFFCC;
	background-repeat: no-repeat;
	background-position: center center;
	position: relative;
}
#head {
	height: 120px;
	width: 100%;
	background-color: #66CCCC;
	text-align: center;
	position: relative;
}

#wrap .logGet {
	height: 560px;
	width: 368px;
	background-color: #FFFFFF;
	top: 10%;
	position: relative;
	margin: 0 auto;
}
.logC a button {
	width: 100%;
	height: 45px;
	background-color: #ee7700;
	border: none;
	color: white;
	font-size: 18px;
}
.logGet .logD.logDtip .p1 {
	display: inline-block;
	font-size: 28px;
	margin-top: 30px;
	width: 86%;
}
#wrap .logGet .logD.logDtip {
	width: 86%;
	border-bottom: 1px solid #ee7700;
	margin-bottom: 40px;
	margin-top: 0px;
	margin-right: auto;
	margin-left: auto;
}

.logGet .lgD input {
	width: 100%;
	height: 42px;
	text-indent: 2.5rem;
}
#wrap .logGet .lgD {
	width: 86%;
	position: relative;
	margin-bottom: 30px;
	margin-top: 30px;
	margin-right: auto;
	margin-left: auto;
}
#wrap .logGet .logC {
	width: 86%;
	margin-top: 0px;
	margin-right: auto;
	margin-bottom: 0px;
	margin-left: auto;
}
.title {
	color: #FFFFFF;
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%); 
	font-size: 36px;
	height: 40px;
	width: 30%;
}
#check{
    font-size: 18px;
    margin-bottom:20px;
	margin-left: 30px;
 }
</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.js"></script>
	<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
</head>
 
<body>
<div class="header" id="head">
  <div class="title">后台管理系统</div>
	
</div>
	
<div class="wrap" id="wrap">
	<div class="logGet">

			<div class="logD logDtip">
				<p class="p1">更新顾客信息</p>
			</div>
			<div class="lgD">产品名
				<input type="text" v-model="commodity"
					placeholder="输入产品名" />
			</div>
			<div class="lgD">品牌
				<input type="text" v-model="brand"
					placeholder="输入产品品牌" />
			</div>
			<div class="lgD">价格
				<input type="text" v-model="price"
					placeholder="输入产品价格" />
			</div>
			<div class="lgD">库存
				<input type="text" v-model="amount"
					placeholder="输入产品库存" />
			</div>

			<div class="logC">
				<a><button @click="save">更 新</button></a>
			</div>
		</div>
</div>	
</div>
<script type="text/javascript">

	Vue.prototype.$http=axios;  //给axios配置原型（全局使用）
	axios.defaults.baseURL='http://localhost:8080/'; //给axios请求设置访问后台的前缀

	//!**************前台拦截器**************

	//1 使用axios前置拦截器，让所有的请求都携带uToken
	axios.interceptors.request.use(config=>{
		//1.1 获取到浏览器里面一直存储的token，并将它放到
		let uToken =  localStorage.getItem("uToken");
		if(uToken){
			//1.2 注意：给请求头里面添加u-token（后台判断就是取的这个请求头）请求头，并把随机数的token值也设置进去
			config.headers['token']=uToken;
		}
		//1.3 必须要返回这个，才能执行后面代码
		return config;
	},error => {
		Promise.reject(error);
	});

	//!**********

	//2 使用axios设置后置拦截器，处理后台被拦截，没有登录的请求
	axios.interceptors.response.use(result=>{
		let data = result.data;
		//只要前台被拦截的请求里面含这两个参数，那么就跳转到登录界面
		if(!data.success && data.msg==="NoUser")
			location.href = "login.html";
		return result;
	},error => {
		Promise.reject(error);
	});


	var id  = sessionStorage.getItem('Id');
    var app =new Vue({
     el: '#wrap',
       data: {
		   commodity:"",
		   brand: "",
		   price:"",
		   amount:"",
		   id:id
       },
	  mounted:function(){
     	id=this.id;
     	console.log(id);
     	this.findById(id);
	  },
     methods: {
		 save: function () {
			 let that = this;
			 axios({
				 method: "post",
				 url: "/Product/updateProduct",
				 data: {
				 	id:that.id,
				 commodity :that.commodity,
				 brand : that.brand,
				 price : that.price,
				 amount : that.amount
				 }
			 }).then(function (response) {
				 if (response.data == true) {
					 console.log(response.data)
					 alert("更新成功 ！！！")
					 window.location.href = "main.html"
				 }
			 }, function (err) {
				 console.log(err.data)
			 })
		 },
		 findById: function (id) {
			 let that = this;
			 axios({
				 method: "post",
				 url: "/Product/findProductById",
				 data: {
					 id
				 }
			 }).then(function (response) {
			 	console.log(response.data)
				 that.commodity = response.data.commodity;
				 that.brand = response.data.brand;
				 that.price = response.data.price;
				 that.amount = response.data.amount;
			 }, function (err) {

			 })
		 }
	 }
      })

</script>
</body>
</html>
